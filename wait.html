<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width" name="viewport"/>
<meta content="#222" name="theme-color"/><meta content="Hexo 6.3.0" name="generator"/>
<link href="/blog/css/main.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" rel="stylesheet"/>
<script class="next-config" data-name="main" type="application/json">{"hostname":"hrfis.me","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","sidebar":"fadeInLeft"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/blog/js/config.js"></script>
<meta content="一些写了之后再也没看过，以后也不一定会看的笔记。
 即“永远不看系列”" name="description"/>
<meta content="article" property="og:type"/>
<meta content="未整理的笔记" property="og:title"/>
<meta content="https://hrfis.me/blog/wait.html" property="og:url"/>
<meta content="若凡的笔记" property="og:site_name"/>
<meta content="一些写了之后再也没看过，以后也不一定会看的笔记。
 即“永远不看系列”" property="og:description"/>
<meta content="zh_CN" property="og:locale"/>
<meta content="https://hrfis.me/blog/images/MapReduce.webp" property="og:image"/>
<meta content="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif" property="og:image"/>
<meta content="2023-09-26T09:45:00.000Z" property="article:published_time"/>
<meta content="2024-06-10T05:13:14.856Z" property="article:modified_time"/>
<meta content="Ruofan" property="article:author"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://hrfis.me/blog/images/MapReduce.webp" name="twitter:image"/>
<link href="https://hrfis.me/blog/wait" rel="canonical"/>
<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hrfis.me/blog/wait.html","path":"/wait.html","title":"未整理的笔记"}</script>
<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>未整理的笔记 | 若凡的笔记</title>
<noscript>
<link href="/blog/css/noscript.css" rel="stylesheet"/>
</noscript>
</head>
<body itemscope="" itemtype="http://schema.org/WebPage">
<div class="headband"></div>
<main class="main">
<div class="column">
<header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
<div class="site-nav-toggle">
<div aria-label="切换导航栏" class="toggle" role="button">
<span class="toggle-line"></span>
<span class="toggle-line"></span>
<span class="toggle-line"></span>
</div>
</div>
<div class="site-meta">
<a class="brand" href="/blog/" rel="start">
<i class="logo-line"></i>
<p class="site-title">若凡的笔记</p>
<i class="logo-line"></i>
</a>
</div>
<div class="site-nav-right">
<div aria-label="搜索" class="toggle popup-trigger" role="button">
</div>
</div>
</div>
<nav class="site-nav">
<ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
</ul>
</nav>
</header>
<aside class="sidebar">
<div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
<ul class="sidebar-nav">
<li class="sidebar-nav-toc">
          文章目录
        </li>
<li class="sidebar-nav-overview">
          站点概览
        </li>
</ul>
<div class="sidebar-panel-container">
<!--noindex-->
<div class="post-toc-wrap sidebar-panel">
<div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode"><span class="nav-number">1.</span> <span class="nav-text">VSCode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E9%9B%86%E6%88%90%E7%BB%88%E7%AB%AF%E6%8C%89%E9%94%AE%E4%B8%8E%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%86%B2%E7%AA%81"><span class="nav-number">1.1.</span> <span class="nav-text">解决集成终端按键与快捷键冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%95"><span class="nav-number">1.2.</span> <span class="nav-text">远程附加调试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8-browser-sync-%E5%AE%9E%E7%8E%B0%E5%9C%A8%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%94%B9%E5%8F%98%E5%90%8E%E7%AB%8B%E5%8D%B3%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.</span> <span class="nav-text">用
browser-sync 实现在文件内容改变后立即刷新页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mapreduce-%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8"><span class="nav-number">3.</span> <span class="nav-text">MapReduce 编程入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#wordcountmapper.java"><span class="nav-number">3.1.</span> <span class="nav-text">WordCountMapper.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wordcountreducer.java"><span class="nav-number">3.2.</span> <span class="nav-text">WordCountReducer.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wordcountdriver.java"><span class="nav-number">3.3.</span> <span class="nav-text">WordCountDriver.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95"><span class="nav-number">3.4.</span> <span class="nav-text">本地测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95"><span class="nav-number">3.5.</span> <span class="nav-text">集群测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-number">3.6.</span> <span class="nav-text">遇到的错误及解决方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hadoop-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%A1%88%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">Hadoop 的序列化案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#javabean"><span class="nav-number">4.1.</span> <span class="nav-text">JavaBean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B"><span class="nav-number">4.2.</span> <span class="nav-text">案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#score.txt"><span class="nav-number">4.3.</span> <span class="nav-text">score.txt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scorebean.java"><span class="nav-number">4.4.</span> <span class="nav-text">ScoreBean.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scorestatsmapper.java"><span class="nav-number">4.5.</span> <span class="nav-text">ScoreStatsMapper.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scorestatsreducer.java"><span class="nav-number">4.6.</span> <span class="nav-text">ScoreStatsReducer.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scorestatsdriver.java"><span class="nav-number">4.7.</span> <span class="nav-text">ScoreStatsDriver.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C"><span class="nav-number">4.8.</span> <span class="nav-text">输出结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9-hadoop-%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-number">5.</span> <span class="nav-text">对 Hadoop 集群启动脚本的注解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hadoop_homesbinstart-all.sh"><span class="nav-number">5.1.</span> <span class="nav-text">$HADOOP_HOME/sbin/start-all.sh</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hadoop_homesbinstart-dfs.sh"><span class="nav-number">5.2.</span> <span class="nav-text">$HADOOP_HOME/sbin/start-dfs.sh</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zookeeper-%E7%9A%84-shell-%E5%91%BD%E4%BB%A4%E5%92%8C-java-api-%E6%93%8D%E4%BD%9C"><span class="nav-number">6.</span> <span class="nav-text">ZooKeeper 的 Shell
命令和 Java API 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#shell-%E5%91%BD%E4%BB%A4"><span class="nav-number">6.1.</span> <span class="nav-text">shell 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#javaapi-%E6%93%8D%E4%BD%9C"><span class="nav-number">6.2.</span> <span class="nav-text">JavaAPI 操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-znode"><span class="nav-number">6.3.</span> <span class="nav-text">创建 Znode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%90%E8%8A%82%E7%82%B9%E5%B9%B6%E7%9B%91%E5%90%AC%E8%8A%82%E7%82%B9%E5%8F%98%E5%8C%96"><span class="nav-number">6.4.</span> <span class="nav-text">获取子节点并监听节点变化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E8%8A%82%E7%82%B9%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="nav-number">6.5.</span> <span class="nav-text">判断节点是否存在</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E6%80%81%E4%B8%8A%E4%B8%8B%E7%BA%BF%E6%A1%88%E4%BE%8B"><span class="nav-number">6.6.</span> <span class="nav-text">服务器动态上下线案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yarn-%E6%A6%82%E8%BF%B0%E5%8F%8A%E6%A1%88%E4%BE%8B"><span class="nav-number">7.</span> <span class="nav-text">YARN 概述及案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9C%80%E6%B1%82"><span class="nav-number">7.1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90-1-%E4%B8%AA-g-%E7%9A%84%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="nav-number">7.2.</span> <span class="nav-text">生成 1 个 G 的文本文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B"><span class="nav-number">7.3.</span> <span class="nav-text">核心参数配置案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E9%87%8F%E8%B0%83%E5%BA%A6%E5%99%A8%E5%A4%9A%E9%98%9F%E5%88%97%E6%8F%90%E4%BA%A4%E6%A1%88%E4%BE%8B"><span class="nav-number">7.4.</span> <span class="nav-text">容量调度器多队列提交案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%E9%98%9F%E5%88%97%E5%8F%8A%E5%AE%B9%E9%87%8F"><span class="nav-number">7.4.1.</span> <span class="nav-text">配置多个队列及容量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E8%A6%81%E6%8F%90%E4%BA%A4%E5%88%B0%E7%9A%84%E9%98%9F%E5%88%97"><span class="nav-number">7.4.2.</span> <span class="nav-text">选择要提交到的队列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%9C%80%E5%A4%A7%E4%BB%BB%E5%8A%A1%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">7.4.3.</span> <span class="nav-text">配置最大任务优先级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E8%B5%84%E6%BA%90%E7%B4%A7%E5%BC%A0%E7%8E%AF%E5%A2%83"><span class="nav-number">7.4.4.</span> <span class="nav-text">模拟资源紧张环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%BF%AE%E6%94%B9%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">7.4.5.</span> <span class="nav-text">执行过程中修改优先级</span></a></li></ol></li></ol></li></ol></div>
</div>
<!--/noindex-->
<div class="site-overview-wrap sidebar-panel">
<div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<p class="site-author-name" itemprop="name">Ruofan</p>
<div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
<nav class="site-state">
<div class="site-state-item site-state-posts">
<a href="/blog/">
<span class="site-state-item-count">27</span>
<span class="site-state-item-name">笔记</span>
</a>
</div>
<div class="site-state-item site-state-categories">
<a href="/blog/categories/">
<span class="site-state-item-count">3</span>
<span class="site-state-item-name">分类</span></a>
</div>
</nav>
</div>
</div>
</div>
</div>
</aside>
</div>
<div class="main-inner post posts-expand">
<div class="post-block">
<article class="post-content" itemscope="" itemtype="http://schema.org/Article" lang="zh-CN">
<link href="https://hrfis.me/blog/wait.html" itemprop="mainEntityOfPage"/>
<span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<meta content="/blog/images/avatar.gif" itemprop="image"/>
<meta content="Ruofan" itemprop="name"/>
</span>
<span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="若凡的笔记" itemprop="name"/>
<meta content="" itemprop="description"/>
</span>
<span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork">
<meta content="未整理的笔记 | 若凡的笔记" itemprop="name"/>
<meta content="" itemprop="description"/>
</span>
<header class="post-header">
<h1 class="post-title" itemprop="name headline">
          未整理的笔记
        </h1>
<div class="post-meta-container">
<div class="post-meta">
<span class="post-meta-item">
<span class="post-meta-item-icon">
<i class="far fa-calendar"></i>
</span>
<span class="post-meta-item-text">发表于</span>
<time datetime="2023-09-26T17:45:00+08:00" itemprop="dateCreated datePublished" title="创建时间：2023-09-26 17:45:00">2023-09-26</time>
</span>
<span class="post-meta-item">
<span class="post-meta-item-icon">
<i class="far fa-calendar-check"></i>
</span>
<span class="post-meta-item-text">更新于</span>
<time datetime="2024-06-10T13:13:14+08:00" itemprop="dateModified" title="修改时间：2024-06-10 13:13:14">2024-06-10</time>
</span>
<span class="post-meta-item">
<span class="post-meta-item-icon">
<i class="far fa-folder"></i>
</span>
<span class="post-meta-item-text">分类于</span>
<span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
<a href="/blog/u/" itemprop="url" rel="index"><span itemprop="name">永远不看系列</span></a>
</span>
</span>
</div>
</div>
</header>
<div class="post-body" itemprop="articleBody"><p>一些写了之后再也没看过，以后也不一定会看的笔记。</p>
<p>即“永远不看系列”</p>
<span id="more"></span>
<h2 id="vscode">VSCode</h2>
<p>工具没用明白</p>
<p>https://code.visualstudio.com/docs/</p>
<h3 id="解决集成终端按键与快捷键冲突">解决集成终端按键与快捷键冲突</h3>
<p><code>Ctrl + Shift + P</code> 打开命令面板，搜键盘快捷方式</p>
<p>搜冲突的按键，右键更改 When 表达式，加上
<code>&amp;&amp; !terminalFocus</code></p>
<h3 id="远程附加调试">远程附加调试</h3>
<p>hadoop-env.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> 某某_OPTS=<span class="string">"-agentlib:jdwp=transport=dt_socket,address=8888,server=y,suspend=n"</span></span><br/></pre></td></tr></table></figure>
<p>launch.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br/><span class="line">  <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"0.2.0"</span><span class="punctuation">,</span></span><br/><span class="line">  <span class="attr">"configurations"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br/><span class="line">    <span class="punctuation">{</span></span><br/><span class="line">      <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"java"</span><span class="punctuation">,</span></span><br/><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"Hadoop 某某"</span><span class="punctuation">,</span></span><br/><span class="line">      <span class="attr">"request"</span><span class="punctuation">:</span> <span class="string">"attach"</span><span class="punctuation">,</span></span><br/><span class="line">      <span class="attr">"hostName"</span><span class="punctuation">:</span> <span class="string">"ubuntu101"</span><span class="punctuation">,</span></span><br/><span class="line">      <span class="attr">"port"</span><span class="punctuation">:</span> <span class="number">8888</span></span><br/><span class="line">    <span class="punctuation">}</span></span><br/><span class="line">  <span class="punctuation">]</span></span><br/><span class="line"><span class="punctuation">}</span></span><br/></pre></td></tr></table></figure>
<h2 id="用-browser-sync-实现在文件内容改变后立即刷新页面">用
browser-sync 实现在文件内容改变后立即刷新页面</h2>
<p>起因是：</p>
<p>不管是直接打开 html
文件，还是用<code>python -m http.server 8000 --bind 127.0.0.1</code>，在修改保存
html 文件后浏览器都不能立马刷新。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">npm install browser-sync</span><br/></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">npx browser-sync start --server --files <span class="string">"."</span></span><br/></pre></td></tr></table></figure>
<p><code>--files</code> 后指定要监视的文件。</p>
<p><code>.</code> 表示监视当前目录以及子目录下的所有文件。</p>
<p>可以改成 <code>*.html</code>，<code>public/*.*</code> 等。</p>
<p>html
文件里至少得有一对<code>&lt;body&gt;</code>标签，要么没法自动刷新。</p>
<h2 id="mapreduce-编程入门">MapReduce 编程入门</h2>
<p><a href="https://github.com/apache/hadoop/blob/branch-3.3.6/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/site/markdown/MapReduceTutorial.md" rel="noopener" target="_blank">官方教程</a></p>
<p><img src="/blog/images/MapReduce.webp"/></p>
<p>我们想统计一篇英文文章里的单词，每个都出现了多少次。假设这个文本文件只有英文单词、空格和换行符（LF
或者 CRLF）。</p>
<p>需要继承 Mapper 类，重写它的 map()
方法。这个方法里传了三个参数：该行的偏移量、该行的文本内容、环境上下文。在这个方法里，对每一行按空格进行分割，形成一个
String[]，遍历这个 String[]，把它写到上下文里，这样写的就是一系列
<code>&lt;word,1&gt;</code>。</p>
<p>继承 Reducer 类，重写 reduce()
方法。。写教程真的很难，笔者前面压根没认真看书，全忘了，只注重形式了，发出来=会了。向写教程的人致敬。</p>
<p>继承 Driver 类，进行一些配置。</p>
<p>官方示例分词用的是 StringTokenizer，其他原理和细节不知道，先跑。</p>
<h3 id="wordcountmapper.java">WordCountMapper.java</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, IntWritable&gt; {</span><br/><span class="line">    <span class="comment">// KEYIN（偏移量），VALUEIN（每一行的文本），KEYOUT（单词），VALUEOUT（1）</span></span><br/><span class="line">    <span class="comment">// 对每一行进行分割</span></span><br/><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">wordText</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();<span class="comment">// 向 context 里写的 KEYOUT。Text 相当于一个盒子</span></span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException {</span><br/><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br/><span class="line">        String[] words = line.split(<span class="string">" "</span>);</span><br/><span class="line"></span><br/><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br/><span class="line">        System.out.println(i++ + <span class="string">" | "</span> + key + <span class="string">" | "</span> + value + <span class="string">" | "</span> + line);</span><br/><span class="line">        <span class="comment">// input 有三行文本</span></span><br/><span class="line">        <span class="comment">// 输出了三次，每次为：1 | 偏移量 | 该行内容（不带换行符） | 该行内容（不带换行符）</span></span><br/><span class="line">        <span class="comment">// 其中 1 没有变，说明是分布执行的</span></span><br/><span class="line">        <span class="comment">// 第一次偏移量为 0，第一行有 35 个英文字母 + 空格，UTF-8 编码，加上 CRLF，第二次偏移量是 37</span></span><br/><span class="line"></span><br/><span class="line">        <span class="keyword">for</span> (String word : words) {</span><br/><span class="line">            wordText.set(word);</span><br/><span class="line">            context.write(wordText, <span class="keyword">new</span> <span class="title class_">IntWritable</span>(<span class="number">1</span>));</span><br/><span class="line">            System.out.println(context.getCurrentKey() + <span class="string">" | "</span> + context.getCurrentValue());</span><br/><span class="line">            <span class="comment">// 这行语句每次输出的 key 和 value 和当前 map() 传的参相同</span></span><br/><span class="line">        }</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="wordcountreducer.java">WordCountReducer.java</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable, Text, IntWritable&gt; {</span><br/><span class="line">    <span class="comment">// KEYIN 和 VALUEIN 来自 WordCountMapper.map() 里向 context 里写的</span></span><br/><span class="line">    <span class="comment">// 每一个 reducer 处理的是 【相同的KEYIN】 的 【VALUEIN集合】</span></span><br/><span class="line">    <span class="type">IntWritable</span> <span class="variable">outV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>();<span class="comment">// VALUEOUT</span></span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span></span><br/><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException {</span><br/><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">// 单词计数</span></span><br/><span class="line"></span><br/><span class="line">        <span class="keyword">for</span> (IntWritable count : values) {</span><br/><span class="line">            sum += count.get();</span><br/><span class="line">            System.out.println(count.get());<span class="comment">// values 的每一个 count 都是 1</span></span><br/><span class="line">        }</span><br/><span class="line"></span><br/><span class="line">        outV.set(sum);</span><br/><span class="line">        context.write(key, outV);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="wordcountdriver.java">WordCountDriver.java</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountDriver</span> {</span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException {</span><br/><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br/><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(conf);</span><br/><span class="line"></span><br/><span class="line">        job.setJarByClass(WordCountDriver.class);</span><br/><span class="line"></span><br/><span class="line">        job.setMapperClass(WordCountMapper.class);</span><br/><span class="line">        job.setReducerClass(WordCountReducer.class);</span><br/><span class="line"></span><br/><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br/><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br/><span class="line"></span><br/><span class="line">        job.setOutputKeyClass(Text.class);</span><br/><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br/><span class="line"></span><br/><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">"input.txt"</span>));</span><br/><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">"output"</span>));</span><br/><span class="line"></span><br/><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br/><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="本地测试">本地测试</h3>
<p><a href="https://github.com/cdarlint/winutils" rel="noopener" target="_blank">winutils</a>，可以先用
3.3.5 的。</p>
<p>winutils 是个什么东西呢？把它放在 Windows 上，然后在 Windows 上运行的
Java 程序可以通过它操作虚拟机。</p>
<h3 id="集群测试">集群测试</h3>
<p>改 <code>WordCountDriver.java</code> 的 IO 路径为传参：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">0</span>]));</span><br/><span class="line">FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">1</span>]));</span><br/></pre></td></tr></table></figure>
<hr/>
<p>笔者这里没有看到 <code>System.out.println()</code> 的内容。</p>
<hr/>
<p>pom.xml（这里不把依赖打成一个 jar 包也可以在虚拟机上执行）:</p>
<h3 id="遇到的错误及解决方法">遇到的错误及解决方法</h3>
<p><code>FileAlreadyExistsException</code>：不要提前建好输出文件夹</p>
<h2 id="hadoop-的序列化案例">Hadoop 的序列化案例</h2>
<p>序列化（serialization）是指将内存中的对象转换成字节序列，以便传输和持久化存储（硬盘）。</p>
<p>反序列化是反过来，把存储在硬盘中的持久化数据转换为内存中的对象。</p>
<p>例如 JSON，它的文本文件属于持久化数据，读 json
文件后转换成对象属于反序列化。</p>
<p>为什么要序列化：内存中的对象是鲜活的，需要把它序列化成标准形式，便于持久化管理和多台计算机通信。对象是“声音”，序列化后是“文字”。</p>
<h3 id="javabean">JavaBean</h3>
<p>是一种遵守某套开发规范的类，可以存储具有整体性的实体信息：学生的姓名、学号、班级等。</p>
<p>规则：</p>
<ul>
<li>必须有一个无参构造方法</li>
<li>所有属性私有，且对其提供 public 的 <code>getXxx()</code> 与
<code>setXxx()</code> 方法</li>
</ul>
<h3 id="案例">案例</h3>
<p>获取 <code>score.txt</code> 里各科成绩的最高分信息</p>
<h3 id="score.txt">score.txt</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/></pre></td><td class="code"><pre><span class="line">张三 语文 73</span><br/><span class="line">张三 数学 97</span><br/><span class="line">张三 英语 21</span><br/><span class="line">张三 物理 72</span><br/><span class="line">张三 化学 49</span><br/><span class="line">张三 生物 69</span><br/><span class="line">李四 语文 106</span><br/><span class="line">李四 数学 112</span><br/><span class="line">李四 英语 38</span><br/><span class="line">李四 物理 42</span><br/><span class="line">李四 化学 47</span><br/><span class="line">李四 生物 78</span><br/><span class="line">王五 语文 108</span><br/><span class="line">王五 数学 143</span><br/><span class="line">王五 英语 9</span><br/><span class="line">王五 物理 8</span><br/><span class="line">王五 化学 84</span><br/><span class="line">王五 生物 14</span><br/><span class="line">陈六 语文 84</span><br/><span class="line">陈六 数学 128</span><br/><span class="line">陈六 英语 68</span><br/><span class="line">陈六 物理 66</span><br/><span class="line">陈六 化学 3</span><br/><span class="line">陈六 生物 78</span><br/></pre></td></tr></table></figure>
<h3 id="scorebean.java">ScoreBean.java</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/><span class="line">51</span><br/><span class="line">52</span><br/><span class="line">53</span><br/><span class="line">54</span><br/><span class="line">55</span><br/><span class="line">56</span><br/><span class="line">57</span><br/><span class="line">58</span><br/><span class="line">59</span><br/><span class="line">60</span><br/><span class="line">61</span><br/><span class="line">62</span><br/><span class="line">63</span><br/><span class="line">64</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test.hrf.hd;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> java.io.DataInput;</span><br/><span class="line"><span class="keyword">import</span> java.io.DataOutput;</span><br/><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Writable;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">class</span> <span class="title class_">ScoreBean</span> <span class="keyword">implements</span> <span class="title class_">Writable</span> {</span><br/><span class="line">    String studentName;</span><br/><span class="line">    String courseName;</span><br/><span class="line">    <span class="type">int</span> score;</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="title function_">ScoreBean</span><span class="params">()</span> {</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        <span class="comment">// 序列化</span></span><br/><span class="line">        <span class="comment">// 这个和下面那个方法, 如果少写了, 会出现 null, 数字变奇怪 之类的错误</span></span><br/><span class="line">        out.writeUTF(studentName);</span><br/><span class="line">        out.writeUTF(courseName);</span><br/><span class="line">        out.writeInt(score);</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        <span class="comment">// 反序列化</span></span><br/><span class="line">        studentName = in.readUTF();</span><br/><span class="line">        courseName = in.readUTF();</span><br/><span class="line">        score = in.readInt();</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br/><span class="line">        <span class="comment">// 好像在 reducer 里的 context.write() 里传 VALUEOUT 后会调用</span></span><br/><span class="line">        <span class="comment">// 如果不重写，会返回类似 "test.hrf.hd.ScoreBean@1aae33be"</span></span><br/><span class="line">        <span class="keyword">return</span> studentName + <span class="string">"\t"</span> + courseName + <span class="string">"\t"</span> + score;</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStudentName</span><span class="params">()</span> {</span><br/><span class="line">        <span class="keyword">return</span> studentName;</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStudentName</span><span class="params">(String studentName)</span> {</span><br/><span class="line">        <span class="built_in">this</span>.studentName = studentName;</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCourseName</span><span class="params">()</span> {</span><br/><span class="line">        <span class="keyword">return</span> courseName;</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCourseName</span><span class="params">(String courseName)</span> {</span><br/><span class="line">        <span class="built_in">this</span>.courseName = courseName;</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getScore</span><span class="params">()</span> {</span><br/><span class="line">        <span class="keyword">return</span> score;</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScore</span><span class="params">(<span class="type">int</span> score)</span> {</span><br/><span class="line">        <span class="built_in">this</span>.score = score;</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="scorestatsmapper.java">ScoreStatsMapper.java</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test.hrf.hd;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">class</span> <span class="title class_">ScoreStatsMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, ScoreBean&gt; {</span><br/><span class="line">    <span class="comment">// KEYIN（偏移量），VALUEIN（每一行的文本），KEYOUT（courseName），VALUEOUT（ScoreBean）</span></span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outK</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();<span class="comment">// courseName</span></span><br/><span class="line">    <span class="keyword">private</span> <span class="type">ScoreBean</span> <span class="variable">outV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScoreBean</span>();</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException {</span><br/><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br/><span class="line">        String[] split = line.split(<span class="string">" "</span>);</span><br/><span class="line"></span><br/><span class="line">        <span class="type">String</span> <span class="variable">studentName</span> <span class="operator">=</span> split[<span class="number">0</span>];</span><br/><span class="line">        <span class="type">String</span> <span class="variable">courseName</span> <span class="operator">=</span> split[<span class="number">1</span>];</span><br/><span class="line">        <span class="type">int</span> <span class="variable">score</span> <span class="operator">=</span> Integer.parseInt(split[<span class="number">2</span>]);</span><br/><span class="line"></span><br/><span class="line">        outK.set(courseName);<span class="comment">// 因为需要找的是对于每门课的最高成绩</span></span><br/><span class="line">        outV.setStudentName(studentName);</span><br/><span class="line">        outV.setCourseName(courseName);</span><br/><span class="line">        outV.setScore(score);</span><br/><span class="line"></span><br/><span class="line">        context.write(outK, outV);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="scorestatsreducer.java">ScoreStatsReducer.java</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test.hrf.hd;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScoreStatsReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, ScoreBean, Text, ScoreBean&gt; {</span><br/><span class="line">    <span class="keyword">private</span> <span class="type">ScoreBean</span> <span class="variable">outV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScoreBean</span>();</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@Override</span></span><br/><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;ScoreBean&gt; values, Context context)</span></span><br/><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException {</span><br/><span class="line">        <span class="comment">// 这里的 key 是 mapper 的 KEYOUT, 即 courseName</span></span><br/><span class="line">        <span class="comment">// 这里的 values 是 map 后同名 key 的 VALUEOUT 集合, 即同课程名的 ScoreBean 集合</span></span><br/><span class="line">        <span class="type">int</span> <span class="variable">currentMaxScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br/><span class="line">        <span class="keyword">for</span> (ScoreBean scoreBean : values) {</span><br/><span class="line"></span><br/><span class="line">            System.out.println(scoreBean.toString());</span><br/><span class="line"></span><br/><span class="line">            <span class="type">int</span> <span class="variable">currentScore</span> <span class="operator">=</span> scoreBean.getScore();</span><br/><span class="line">            <span class="keyword">if</span> (currentScore &gt; currentMaxScore) {</span><br/><span class="line">                currentMaxScore = currentScore;</span><br/><span class="line"></span><br/><span class="line">                outV = <span class="keyword">new</span> <span class="title class_">ScoreBean</span>();<span class="comment">// 如果用浅拷贝, 会在退出循环后变成最后一个</span></span><br/><span class="line">                outV.setStudentName(scoreBean.getStudentName());</span><br/><span class="line">                outV.setCourseName(scoreBean.getCourseName());</span><br/><span class="line">                outV.setScore(currentMaxScore);</span><br/><span class="line">            }</span><br/><span class="line">        }</span><br/><span class="line"></span><br/><span class="line">        context.write(key, outV);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="scorestatsdriver.java">ScoreStatsDriver.java</h3>
<p>适当改 Path</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test.hrf.hd;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br/><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br/><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScoreStatsDriver</span> {</span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException {</span><br/><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br/><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(conf);</span><br/><span class="line"></span><br/><span class="line">        job.setJarByClass(ScoreStatsDriver.class);</span><br/><span class="line"></span><br/><span class="line">        job.setMapperClass(ScoreStatsMapper.class);</span><br/><span class="line">        job.setReducerClass(ScoreStatsReducer.class);</span><br/><span class="line"></span><br/><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br/><span class="line">        job.setMapOutputValueClass(ScoreBean.class);</span><br/><span class="line"></span><br/><span class="line">        job.setOutputKeyClass(Text.class);</span><br/><span class="line">        job.setOutputValueClass(ScoreBean.class);</span><br/><span class="line"></span><br/><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">"score.txt"</span>));</span><br/><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">"output"</span>));</span><br/><span class="line"></span><br/><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br/><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="输出结果">输出结果</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line">化学	王五	化学	84</span><br/><span class="line">数学	王五	数学	143</span><br/><span class="line">物理	张三	物理	72</span><br/><span class="line">生物	陈六	生物	78</span><br/><span class="line">英语	陈六	英语	68</span><br/><span class="line">语文	王五	语文	108</span><br/></pre></td></tr></table></figure>
<h2 id="对-hadoop-集群启动脚本的注解">对 Hadoop 集群启动脚本的注解</h2>
<p>r3.3.6</p>
<ul>
<li><a href="https://hadoop.apache.org/docs/r3.3.6/hadoop-project-dist/hadoop-common/UnixShellAPI.html" rel="noopener" target="_blank">UnixShellAPI</a></li>
</ul>
<h3 id="hadoop_homesbinstart-all.sh">$HADOOP_HOME/sbin/start-all.sh</h3>
<p>对应
https://github.com/apache/hadoop/blob/branch-3.3.6/hadoop-common-project/hadoop-common/src/main/bin/start-all.sh</p>
<p>干的事：</p>
<ol type="1">
<li>【28-36】找目录
<code>${HADOOP_HOME}/libexec</code>，里面有其他脚本，和配置文件
<code>hadoop-config.sh</code></li>
<li>【38-44】把 <code>hadoop-config.sh</code> 包含到当前脚本里</li>
<li>【46-53】如果 <code>hadoop_privilege_check</code> 返回 0，进行 10
秒的启动前确认</li>
<li>【55-63】运行另两个启动脚本 <code>start-dfs.sh</code> 和
<code>start-yarn.sh</code></li>
</ol>
<ul>
<li>28：if [[-n]] 判断字符串非空，非空为 1</li>
<li>31：获取当前脚本的完整路径。$0 表示当前脚本的名称（含扩展名）</li>
<li>32：-P 表示使用物理路径，不使用软链接。--
表示后面跟的不是选项了，是参数。对于 dirname
命令，如果路径不以/结束，返回最后一个/之前的内容；如果路径以/结束，返回倒数第二个/之前的内容。&gt;/dev/null
就是把输出重定向到 /dev/null，丢弃输出的数据。pwd
获取当前目录的绝对路径</li>
<li>37：注释告诉 ShellCheck 工具忽略 SC2034
警告（定义了未使用的变量）</li>
<li>39：-f
用于检查文件是否存在，并且是一个常规文件（不是目录、符号链接、设备文件或管道）</li>
<li>40：. 将另一个脚本包含到当前脚本中</li>
<li>42：2&gt;&amp;1 将标准错误输出重定向到标准输出</li>
<li>47：trap 设置信号处理程序</li>
<li>52：取消对 INT 信号的捕获</li>
</ul>
<h3 id="hadoop_homesbinstart-dfs.sh">$HADOOP_HOME/sbin/start-dfs.sh</h3>
<p>对应
https://github.com/apache/hadoop/blob/branch-3.3.6/hadoop-hdfs-project/hadoop-hdfs/src/main/bin/start-dfs.sh</p>
<p>干的事：</p>
<ol type="1">
<li>【43-61】同样找 <code>${HADOOP_HOME}/libexec</code> 目录，并包含
<code>hdfs-config.sh</code></li>
<li>【63-78】对本脚本传参个数大于等于一个时，如果第一个参数为
<code>-upgrade</code> 或 <code>-rollback</code>，把它赋值给
<code>nameStartOpt</code> 或 <code>dataStartOpt</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line">- 64: $# 参数个数，-ge 大于等于</span><br/><span class="line">- 66：shift 把所有参数“左移”一位（丢弃第一个参数，原来第二个参数变成第一个参数……）</span><br/><span class="line">- 82：$\* 所有当前参数（shift 后的）拼接起来的字符串</span><br/><span class="line">- 89：if [[-z]] 判断字符串空，空为 1</span><br/><span class="line">- 101：$? 上一个进程结束的状态码，0 成功 1 失败</span><br/><span class="line">- 112：(( )) 可在里面进行算术运算并赋值</span><br/><span class="line">- 121：=~ 正则匹配</span><br/><span class="line">- 147：2&gt;&amp;- 把标准错误输出重定向到“关闭”</span><br/><span class="line">- 149：`"${#JOURNAL_NODES}"` 获取 JOURNAL_NODES 变量存储的字符串的长度</span><br/><span class="line">- 163：| tr '[:upper:]' '[:lower:]' 把前面的输出结果通过管道传递给 tr 命令，转换成小写字母</span><br/></pre></td></tr></table></figure>
<h2 id="zookeeper-的-shell-命令和-java-api-操作">ZooKeeper 的 Shell
命令和 Java API 操作</h2>
<h3 id="shell-命令">shell 命令</h3>
<p>前提是服务端正常（半数以上节点存活），在启动了某一台存活机器上的客户端后的操作：</p>
<p>见 <code>$ZK_HOME/docs/zookeeperCLI.html</code></p>
<p>https://zookeeper.apache.org/doc/r3.8.2/zookeeperCLI.html</p>
<ul>
<li>创建节点：<code>create [-s] [-e] /path/to/node "content"</code>
<ul>
<li><code>-s</code>：带序号，就是在节点名后面加上数字</li>
<li><code>-e</code>：临时节点，在【创建此节点的那一方客户端退出】后会被删除</li>
</ul></li>
<li>查看节点详细信息：<code>get -s /path/to/node</code>（不
<code>-s</code> 时只查看值）（与 <code>stat /path/to/node</code>
效果一样）</li>
<li>修改节点数据值：<code>set /path/to/node "content"</code></li>
<li>删除与递归删除节点：<code>delete /path/to/node</code>
<code>deleteall /path/to/node</code></li>
<li>节点的值变化监听： <code>get -w /path/to/node</code>
（节点被删除时也会被捕获）</li>
<li>节点的子节点（路径）变化监听： <code>ls -w /path/to/node</code>
（节点值变化时不会被捕获）</li>
<li>列出路径下的所有子节点：<code>ls -R /path</code></li>
</ul>
<h3 id="javaapi-操作">JavaAPI 操作</h3>
<p>使用了 <a href="https://junit.org/junit5/docs/current/user-guide/" rel="noopener" target="_blank">JUnit5</a>
测试框架，在 <code>工程目录/src/test/java</code> 下创建 java
源文件进行测试。</p>
<ol start="4" type="1">
<li><p>适当修改 pom.xml 里的 <code>&lt;maven.compiler.source&gt;</code>
和 <code>&lt;maven.compiler.target&gt;</code> 的 JDK 版本。</p></li>
<li><p><code>mvn install</code></p></li>
<li><p><code>src/main/resources</code> 里加
<code>log4j.properties</code> 配置文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">INFO, stdout</span></span><br/><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br/><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br/><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br/><span class="line"><span class="attr">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br/><span class="line"><span class="attr">log4j.appender.logfile.File</span>=<span class="string">target/spring.log</span></span><br/><span class="line"><span class="attr">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br/><span class="line"><span class="attr">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br/></pre></td></tr></table></figure></li>
<li><p>在 <code>src/test/java</code> 下建
<code>zkClient.java</code></p></li>
</ol>
<h3 id="创建-znode">创建 Znode</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br/><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br/><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">zkClient</span> {</span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">"ubuntu101:2181"</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="type">ZooKeeper</span> <span class="variable">zkClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@BeforeEach</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        zkClient = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() {</span><br/><span class="line">            <span class="meta">@Override</span></span><br/><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> {</span><br/><span class="line">            }</span><br/><span class="line">        });</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="comment">// 该方法在测试时只会被调用一次</span></span><br/><span class="line">    <span class="meta">@Test</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException {</span><br/><span class="line">        <span class="comment">// 创建一个所有客户端都可读写、持久的节点</span></span><br/><span class="line">        zkClient.create(<span class="string">"/fruit1"</span>, <span class="string">"apple"</span>.getBytes(),</span><br/><span class="line">                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br/><span class="line">        System.out.println(<span class="string">"节点创建成功"</span>);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="获取子节点并监听节点变化">获取子节点并监听节点变化</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"><span class="keyword">import</span> java.util.List;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br/><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br/><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">zkClient</span> {</span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">"ubuntu101:2181"</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="type">ZooKeeper</span> <span class="variable">zkClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@BeforeEach</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        zkClient = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout,</span><br/><span class="line">                <span class="keyword">new</span> <span class="title class_">Watcher</span>() {</span><br/><span class="line">                    <span class="meta">@Override</span></span><br/><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> {</span><br/><span class="line">                        System.out.println(<span class="string">"---start-------------------------------------"</span>);</span><br/><span class="line">                        List&lt;String&gt; children = <span class="literal">null</span>;</span><br/><span class="line">                        <span class="keyword">try</span> {</span><br/><span class="line">                            children = zkClient.getChildren(<span class="string">"/"</span>, <span class="literal">true</span>);</span><br/><span class="line">                        } <span class="keyword">catch</span> (KeeperException | InterruptedException e) {</span><br/><span class="line">                            e.printStackTrace();</span><br/><span class="line">                        }</span><br/><span class="line">                        children.forEach(System.out::println);</span><br/><span class="line">                        System.out.println(<span class="string">"---end--------------------------------------"</span>);</span><br/><span class="line">                    }</span><br/><span class="line">                });</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="comment">// 该方法在测试时只会被调用一次</span></span><br/><span class="line">    <span class="meta">@Test</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br/><span class="line">        Thread.sleep(Long.MAX_VALUE);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="判断节点是否存在">判断节点是否存在</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br/><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br/><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">zkClient</span> {</span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">"ubuntu101:2181"</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="type">ZooKeeper</span> <span class="variable">zkClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br/><span class="line"></span><br/><span class="line">    <span class="meta">@BeforeEach</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        zkClient = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout,</span><br/><span class="line">                <span class="keyword">new</span> <span class="title class_">Watcher</span>() {</span><br/><span class="line">                    <span class="meta">@Override</span></span><br/><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> {</span><br/><span class="line">                    }</span><br/><span class="line">                });</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="comment">// 该方法在测试时只会被调用一次</span></span><br/><span class="line">    <span class="meta">@Test</span></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException {</span><br/><span class="line">        <span class="type">Stat</span> <span class="variable">sta</span> <span class="operator">=</span> zkClient.exists(<span class="string">"/fruit"</span>, <span class="literal">false</span>);</span><br/><span class="line">        System.out.println(<span class="literal">null</span> == sta ? <span class="string">"不存在"</span> : <span class="string">"存在"</span>);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h3 id="服务器动态上下线案例">服务器动态上下线案例</h3>
<p>模拟服务器动态上下线：</p>
<ol type="1">
<li>提前创建 <code>/servers</code> 节点</li>
<li><ul>
<li>DistributeClient
监听服务器上下线（监听<code>/servers</code>下子路径的变化）</li>
<li>DistributeServer
模拟服务器上下线（创建/删除<code>/servers/hostname</code>）</li>
</ul></li>
<li>上/下线后的业务逻辑</li>
</ol>
<p><code>DistributeClient.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/><span class="line">51</span><br/><span class="line">52</span><br/><span class="line">53</span><br/><span class="line">54</span><br/><span class="line">55</span><br/><span class="line">56</span><br/><span class="line">57</span><br/><span class="line">58</span><br/><span class="line">59</span><br/><span class="line">60</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br/><span class="line"><span class="keyword">import</span> java.util.List;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributeClient</span> {</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">"ubuntu101:2181,ubuntu102:2181,ubuntu103:2181"</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br/><span class="line">    <span class="keyword">private</span> ZooKeeper zk;</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException {</span><br/><span class="line">        <span class="type">DistributeClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DistributeClient</span>();</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 1 获取ZK连接</span></span><br/><span class="line">        client.getConnect();</span><br/><span class="line">        <span class="comment">// 2 监听服务器下/servers下面子节点的增加和删除</span></span><br/><span class="line">        client.getServerList();</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 3 相关业务逻辑（主要是添加延迟函数）</span></span><br/><span class="line">        client.buisiness();</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buisiness</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br/><span class="line">        Thread.sleep(Long.MAX_VALUE);</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getServerList</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException {</span><br/><span class="line">        <span class="comment">// 第二个参数设置为true,监听走的是getConnect下的process方法。</span></span><br/><span class="line">        List&lt;String&gt; children = zk.getChildren(<span class="string">"/servers"</span>, <span class="literal">true</span>);</span><br/><span class="line">        <span class="comment">// 循环取出每一个节点对应的主机名称</span></span><br/><span class="line">        ArrayList&lt;Object&gt; servers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();<span class="comment">// 存储servers下的所有节点名称</span></span><br/><span class="line">        <span class="keyword">for</span> (String child : children) {</span><br/><span class="line">            <span class="type">byte</span>[] data = zk.getData(<span class="string">"/servers/"</span> + child, <span class="literal">false</span>, <span class="literal">null</span>);</span><br/><span class="line">            servers.add(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br/><span class="line">        }</span><br/><span class="line">        <span class="comment">// 打印</span></span><br/><span class="line">        System.out.println(servers);</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getConnect</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        zk = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() {</span><br/><span class="line">            <span class="meta">@Override</span></span><br/><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> {</span><br/><span class="line">                <span class="comment">// 因为注册一次，只能监听一次，所以需要在监听方法里面再注册一下</span></span><br/><span class="line">                <span class="keyword">try</span> {</span><br/><span class="line">                    getServerList();</span><br/><span class="line">                } <span class="keyword">catch</span> (KeeperException e) {</span><br/><span class="line">                    e.printStackTrace();</span><br/><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br/><span class="line">                    e.printStackTrace();</span><br/><span class="line">                }</span><br/><span class="line">            }</span><br/><span class="line">        });</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<p><code>DistributeServer.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs;</span><br/><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistributeServer</span> {</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">"ubuntu101:2181,ubuntu102:2181"</span>;</span><br/><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> <span class="number">2000</span>;</span><br/><span class="line">    <span class="keyword">private</span> ZooKeeper zk;</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException {</span><br/><span class="line"></span><br/><span class="line">        <span class="type">DistributeServer</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DistributeServer</span>();</span><br/><span class="line">        <span class="comment">// 1. 连接zookeeper集群</span></span><br/><span class="line">        server.getConnect();</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 2. 向集群进行注册（也就是创建服务器的路径）</span></span><br/><span class="line">        server.regist(args[<span class="number">0</span>]);</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">// 3. 业务逻辑的代码</span></span><br/><span class="line">        <span class="comment">// 添加延迟函数，防止程序结束了，看不到节点的相关变化</span></span><br/><span class="line">        server.business();</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">business</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br/><span class="line">        Thread.sleep(Long.MAX_VALUE);</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">regist</span><span class="params">(String hostname)</span> <span class="keyword">throws</span> KeeperException, InterruptedException {</span><br/><span class="line">        <span class="comment">// znode 将在客户端断开连接时被删除，并且其名称将附加单调递增的数字</span></span><br/><span class="line">        <span class="type">String</span> <span class="variable">create</span> <span class="operator">=</span> zk.create(<span class="string">"/servers/"</span> + hostname, hostname.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE,</span><br/><span class="line">                CreateMode.EPHEMERAL_SEQUENTIAL);</span><br/><span class="line">        System.out.println(hostname + <span class="string">" is online"</span>);</span><br/><span class="line">    }</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getConnect</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        zk = <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(connectString, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() {</span><br/><span class="line">            <span class="meta">@Override</span></span><br/><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> {</span><br/><span class="line"></span><br/><span class="line">            }</span><br/><span class="line">        });</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<h2 id="yarn-概述及案例">YARN 概述及案例</h2>
<p>Yet Another Resouce Negotiator</p>
<p>另一种资源调度器</p>
<p>为什么叫另一种：新的</p>
<p><img src="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif"/></p>
<ul>
<li>资源管理器 ResourceManager：集群老大</li>
<li>节点管理器 NodeManager：节点老大</li>
<li>容器 Container：每个节点里的多个小电脑</li>
<li>ApplicatonMaster：用户提交的应用程序里的老大</li>
</ul>
<p>FIFO 调度器</p>
<p>容量调度器：按设置的比例</p>
<p>公平调度器：公平</p>
<h3 id="需求">需求</h3>
<p>需求：从 1G 数据中，统计每个单词出现次数。</p>
<p>需求分析： 1G / 128m = 8 个 MapTask；1 个 ReduceTask；1 个
mrAppMaster 平均每个节点运行 10 个 / 3 台 ≈ 3 个任务（3 3 4）</p>
<p>修改 <code>yarn-site.xml</code><a href="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-common/yarn-default.xml" rel="noopener" target="_blank">（yarn-default.xml）</a>
后分发，停启 yarn。</p>
<h3 id="生成-1-个-g-的文本文件">生成 1 个 G 的文本文件</h3>
<p>三个小写字母 + 一个 LF</p>
<p>注意要分行……之前就一行，用空格分隔的，读文件的时候堆溢出了，搁那改配置文件去了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br/><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br/><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br/><span class="line"><span class="keyword">import</span> java.util.Random;</span><br/><span class="line"></span><br/><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br/><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {</span><br/><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">"D:/1/1.txt"</span>;</span><br/><span class="line"></span><br/><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filePath);</span><br/><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(fos);</span><br/><span class="line">        <span class="type">int</span> <span class="variable">minAscii</span> <span class="operator">=</span> <span class="string">'a'</span>;</span><br/><span class="line">        <span class="type">int</span> <span class="variable">maxAscii</span> <span class="operator">=</span> <span class="string">'z'</span>;</span><br/><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br/><span class="line"></span><br/><span class="line">        <span class="type">long</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">28</span>;</span><br/><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br/><span class="line"></span><br/><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s; i++) {</span><br/><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) {</span><br/><span class="line">                <span class="type">byte</span> <span class="variable">randomByte</span> <span class="operator">=</span> (<span class="type">byte</span>) (minAscii + random.nextInt(maxAscii - minAscii + <span class="number">1</span>));</span><br/><span class="line">                buffer[j] = randomByte;</span><br/><span class="line">            }</span><br/><span class="line">            buffer[<span class="number">3</span>] = <span class="string">'\n'</span>;</span><br/><span class="line">            bos.write(buffer, <span class="number">0</span>, <span class="number">4</span>);</span><br/><span class="line">        }</span><br/><span class="line"></span><br/><span class="line">        bos.flush();</span><br/><span class="line">        bos.close();</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<p>在物理机上写文件，用 xftp 传到虚拟机上，上传到 HDFS</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line">hadoop fs -<span class="built_in">mkdir</span> /wcinput</span><br/><span class="line">hadoop fs -put ./1.txt /wcinput/1.txt</span><br/></pre></td></tr></table></figure>
<p>或者直接通过 Web UI 上传。</p>
<h3 id="核心参数配置案例">核心参数配置案例</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.6.jar wordcount /wcinput /wcoutput</span><br/></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/><span class="line">51</span><br/><span class="line">52</span><br/><span class="line">53</span><br/><span class="line">54</span><br/><span class="line">55</span><br/><span class="line">56</span><br/><span class="line">57</span><br/><span class="line">58</span><br/><span class="line">59</span><br/><span class="line">60</span><br/><span class="line">61</span><br/><span class="line">62</span><br/><span class="line">63</span><br/><span class="line">64</span><br/><span class="line">65</span><br/><span class="line">66</span><br/><span class="line">67</span><br/><span class="line">68</span><br/><span class="line">69</span><br/><span class="line">70</span><br/><span class="line">71</span><br/><span class="line">72</span><br/><span class="line">73</span><br/><span class="line">74</span><br/><span class="line">75</span><br/><span class="line">76</span><br/><span class="line">77</span><br/><span class="line">78</span><br/><span class="line">79</span><br/><span class="line">80</span><br/><span class="line">81</span><br/><span class="line">82</span><br/><span class="line">83</span><br/><span class="line">84</span><br/><span class="line">85</span><br/><span class="line">86</span><br/><span class="line">87</span><br/><span class="line">88</span><br/><span class="line">89</span><br/><span class="line">90</span><br/><span class="line">91</span><br/><span class="line">92</span><br/><span class="line">93</span><br/><span class="line">94</span><br/><span class="line">95</span><br/><span class="line">96</span><br/><span class="line">97</span><br/><span class="line">98</span><br/><span class="line">99</span><br/><span class="line">100</span><br/><span class="line">101</span><br/><span class="line">102</span><br/><span class="line">103</span><br/><span class="line">104</span><br/><span class="line">105</span><br/><span class="line">106</span><br/><span class="line">107</span><br/><span class="line">108</span><br/><span class="line">109</span><br/><span class="line">110</span><br/><span class="line">111</span><br/><span class="line">112</span><br/><span class="line">113</span><br/><span class="line">114</span><br/><span class="line">115</span><br/><span class="line">116</span><br/><span class="line">117</span><br/><span class="line">118</span><br/><span class="line">119</span><br/><span class="line">120</span><br/><span class="line">121</span><br/><span class="line">122</span><br/><span class="line">123</span><br/><span class="line">124</span><br/><span class="line">125</span><br/><span class="line">126</span><br/><span class="line">127</span><br/><span class="line">128</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 选择调度器，默认容量 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>The class to use as the resource scheduler.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- ResourceManager处理调度器请求的线程数量,默认50；如果提交的任务数大于50，可以增加该值，但是不能超过3台 * 4线程 = 12线程（去除其他应用程序实际不能超过8） --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Number of threads to handle scheduler interface.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.client.thread-count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 是否让yarn自动检测硬件进行配置，默认是false，如果该节点有很多其他应用程序，建议手动配置。如果该节点没有其他应用程序，可以采用自动 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Enable auto-detection of node capabilities such as</span><br/><span class="line">			memory and CPU.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.detect-hardware-capabilities<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 是否将虚拟核数当作CPU核数，默认是false，采用物理CPU核数 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Flag to determine if logical processors(such as</span><br/><span class="line">			hyperthreads) should be counted as cores. Only applicable on Linux</span><br/><span class="line">			when yarn.nodemanager.resource.cpu-vcores is set to -1 and</span><br/><span class="line">			yarn.nodemanager.resource.detect-hardware-capabilities is true.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.count-logical-processors-as-cores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 虚拟核数和物理核数乘数，默认是1.0 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Multiplier to determine how to convert phyiscal cores to</span><br/><span class="line">			vcores. This value is used if yarn.nodemanager.resource.cpu-vcores</span><br/><span class="line">			is set to -1(which implies auto-calculate vcores) and</span><br/><span class="line">			yarn.nodemanager.resource.detect-hardware-capabilities is set to true. The number of</span><br/><span class="line">			vcores will be calculated as number of CPUs * multiplier.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.pcores-vcores-multiplier<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- NodeManager使用内存数，默认8G，修改为4G内存 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Amount of physical memory, in MB, that can be allocated</span><br/><span class="line">			for containers. If set to -1 and</span><br/><span class="line">			yarn.nodemanager.resource.detect-hardware-capabilities is true, it is</span><br/><span class="line">			automatically calculated(in case of Windows and Linux).</span><br/><span class="line">			In other cases, the default is 8192MB.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- nodemanager的CPU核数，不按照硬件环境自动设定时默认是8个，修改为4个 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Number of vcores that can be allocated</span><br/><span class="line">			for containers. This is used by the RM scheduler when allocating</span><br/><span class="line">			resources for containers. This is not used to limit the number of</span><br/><span class="line">			CPUs used by YARN containers. If it is set to -1 and</span><br/><span class="line">			yarn.nodemanager.resource.detect-hardware-capabilities is true, it is</span><br/><span class="line">			automatically determined from the hardware in case of Windows and Linux.</span><br/><span class="line">			In other cases, number of vcores is 8 by default.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 容器最小内存，默认1G --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>The minimum allocation for every container request at the RM in MBs. Memory</span><br/><span class="line">			requests lower than this will be set to the value of this property. Additionally, a node</span><br/><span class="line">			manager that is configured to have less memory than this value will be shut down by the</span><br/><span class="line">			resource manager.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 容器最大内存，默认8G，修改为2G --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>The maximum allocation for every container request at the RM in MBs. Memory</span><br/><span class="line">			requests higher than this will throw an InvalidResourceRequestException.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 容器最小CPU核数，默认1个 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>The minimum allocation for every container request at the RM in terms of</span><br/><span class="line">			virtual CPU cores. Requests lower than this will be set to the value of this property.</span><br/><span class="line">			Additionally, a node manager that is configured to have fewer virtual cores than this</span><br/><span class="line">			value will be shut down by the resource manager.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 容器最大CPU核数，默认4个，修改为2个 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>The maximum allocation for every container request at the RM in terms of</span><br/><span class="line">			virtual CPU cores. Requests higher than this will throw an</span><br/><span class="line">			InvalidResourceRequestException.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 虚拟内存检查，默认打开，修改为关闭 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Whether virtual memory limits will be enforced for</span><br/><span class="line">			containers.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/><span class="line"></span><br/><span class="line">	<span class="comment">&lt;!-- 虚拟内存和物理内存设置比例,默认2.1 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">description</span>&gt;</span>Ratio between virtual memory to physical memory when setting memory limits for</span><br/><span class="line">			containers. Container allocations are expressed in terms of physical memory, and virtual</span><br/><span class="line">			memory usage is allowed to exceed this allocation by this ratio.</span><br/><span class="line">		<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-pmem-ratio<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/></pre></td></tr></table></figure>
<h3 id="容量调度器多队列提交案例">容量调度器多队列提交案例</h3>
<h4 id="配置多个队列及容量">配置多个队列及容量</h4>
<p>改 capacity-scheduler.xml:</p>
<ul>
<li><code>yarn.scheduler.capacity.root.queues</code>:
default,队列名</li>
<li><code>yarn.scheduler.capacity.root.default.capacity</code></li>
<li><code>yarn.scheduler.capacity.root.default.maximum-capacity</code></li>
</ul>
<p>新增：</p>
<ul>
<li><code>yarn.scheduler.capacity.root.队列名.</code>
<ul>
<li>capacity：容量</li>
<li>maximum-capacity</li>
<li>user-limit-factor：用户可使用的队列资源极限系数</li>
<li>state：RUNNING</li>
<li>acl_administer_queue：*
哪些用户有权操作队列，管理员权限（查看/杀死）</li>
<li>acl_application_max_priority：* 哪些用户有权配置提交任务优先级</li>
<li>maximum-application-lifetime：-1 如果 application
指定了超时时间，则提交到该队列的 application
能够指定的最大超时时间不能超过该值</li>
<li>default-application-lifetime：-1 如果 application
没指定超时时间，则用 default-application-lifetime 作为默认值</li>
</ul></li>
</ul>
<h4 id="选择要提交到的队列">选择要提交到的队列</h4>
<p>默认是 default</p>
<p>shell：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.6.jar wordcount -D mapreduce.job.queuename=队列名 /wcinput /wcoutput</span><br/></pre></td></tr></table></figure>
<p>或者 Driver 类里 <code>conf.set()</code></p>
<h4 id="配置最大任务优先级">配置最大任务优先级</h4>
<p>yarn-site.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br/><span class="line">	<span class="comment">&lt;!-- 最大任务优先级 --&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.cluster.max-application-priority<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br/><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br/><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br/></pre></td></tr></table></figure>
<h4 id="模拟资源紧张环境">模拟资源紧张环境</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.6.jar pi 5 2000000 &amp;</span><br/></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> hadoop jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.6.jar pi -D mapreduce.job.priority=5 5 2000000 &amp;</span><br/></pre></td></tr></table></figure>
<h4 id="执行过程中修改优先级">执行过程中修改优先级</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line">yarn application -appID &lt;ApplicationID&gt; -updatePriority 优先级</span><br/></pre></td></tr></table></figure>
</div>
<footer class="post-footer">
<div class="post-nav">
<div class="post-nav-item">
<a href="/blog/algorithm.html" rel="prev" title="算法">
<i class="fa fa-chevron-left"></i> 算法
                </a>
</div>
<div class="post-nav-item">
<a href="/blog/credits.html" rel="next" title="获取正方教务系统里的成绩信息并对学分求和">
                  获取正方教务系统里的成绩信息并对学分求和 <i class="fa fa-chevron-right"></i>
</a>
</div>
</div>
</footer>
</article>
</div>
</div>
</main>
<footer class="footer">
<div class="footer-inner">
<div class="copyright">
  2023 – 
  <span itemprop="copyrightYear">2024</span>
<span class="with-love">
<i class="fa fa-heart"></i>
</span>
<span class="author" itemprop="copyrightHolder">Ruofan</span>
</div>
</div>
</footer>
<div aria-label="返回顶部" class="back-to-top" role="button">
<i class="fa fa-arrow-up fa-lg"></i>
<span>0%</span>
</div>
<div class="reading-progress-bar"></div>
<noscript>
<div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script crossorigin="anonymous" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script crossorigin="anonymous" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/next-boot.js"></script>
<script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
<script src="/blog/js/third-party/tags/mermaid.js"></script>
<script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/blog/js/third-party/math/mathjax.js"></script>
<script crossorigin="anonymous" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js"></script>
<script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://hrfis.me/blog/wait.html"}</script>
<script src="/blog/js/third-party/quicklink.js"></script>
</body>
</html>
